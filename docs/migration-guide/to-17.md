# Migrating to 17.0.0

This release contains breaking or significant changes.

## Breaking changes

We've:

- removed CommonJs Node.js API
- removed `output` property in the Node.js API returned resolved object
- removed support for Node.js less than 20.19.0 and 22.13.0
- removed GitHub formatter
- changed default `fix` mode to `strict`
- changed report to be consistent and predictable in how it handles the provided position arguments
- changed `*-list` rules to have consistent behaviour for vendor prefixes and capitalisation

### Removed CommonJs Node.js API

We've removed the CommonJs Node.js API that we deprecated in 16.0.0.

We recommend updating any consuming code to ESM (ECMAScript modules) as detailed in our [16.0.0 migration guide](./to-16.md#deprecated-commonjs-api).

Alternatively, Node.js 20+ supports `require(ESM)` so you can continue to `require` Stylelint with one small change:

```diff js
-const stylelint = require("stylelint");
+const stylelint = require("stylelint").default;
```

Make this change if you encounter either of the following errors when consuming Stylelint:

- `Cannot read properties of undefined (reading 'report')`
- `TypeError: stylelint.lint is not a function`

### Removed `output` property in the Node.js API returned resolved object

We've removed the `output` property that we [deprecated in 16.0.0](./to-16.md#changed-nodejs-api-returned-resolved-object).

If you use `stylelint.lint()` and `fix: true`, you should update your code to:

```diff js
 const result = await stylelint.lint({
   code: "a {}",
   fix: true
 });
-const fixedCode = result.output;
+const formattedProblems = result.report;
+const fixedCode = result.code;
```

### Removed support for Node.js less than 20.19.0 and 22.13.0

We've removed support for Node.js versions less than 20.19.0 and 22.13.0, including end-of-life 18.x, to update all our dependencies.

We update our dependencies on a [cool-down](https://github.blog/changelog/2025-07-01-dependabot-supports-configuration-of-a-minimum-package-age/) to improve supply chain security, alongside [immutable releases](https://github.blog/changelog/2025-08-26-releases-now-support-immutability-in-public-preview/) on GitHub and [trusted publishing](https://github.blog/changelog/2025-07-31-npm-trusted-publishing-with-oidc-is-generally-available/) to npm.

We recommend updating to the latest version of Node.js.

### Removed GitHub formatter

We've removed the GitHub formatter than [we deprecated in 16.8.0](../../CHANGELOG.md#1680---2024-07-29).

You can use a formatter maintained by the community instead, such as [@csstools/stylelint-formatter-github](https://www.npmjs.com/package/@csstools/stylelint-formatter-github):

```shell
npm install --save-dev @csstools/stylelint-formatter-github
```

Using the Node.js API:

```diff js
import stylelint from "stylelint";
+import formatter from "@csstools/stylelint-formatter-github";

const result = await stylelint.lint({
  files: "**/*.css",
- formatter: "github",
+ formatter,
});
```

Using the CLI:

```diff shell
-stylelint "**/*.css" --formatter github
+stylelint "**/*.css" --custom-formatter @csstools/stylelint-formatter-github
```

### Changed default `fix` mode to `strict`

We've changed the default mode of `fix` to `strict`: one of the two modes that [we added in 16.13.0](../../CHANGELOG.md#16130---2025-01-12).

In `strict` mode, Stylelint will only fix problems when there are no syntax errors in the source. This mode is safer than the `lax` mode, especially when fixing code that uses nesting.

If you want to reinstate the previous behaviour, you can set the `lax` value for the `--fix` flag:

```diff shell
-stylelint "**/*.css" --fix
+stylelint "**/*.css" --fix=lax
```

We've also removed the use of `fix=false` to turn off fixing. Remove the flag entirely instead:

```diff shell
-stylelint "**/*.css" --fix=false
+stylelint "**/*.css"
```

### Changed `report` to be consistent and predictable in how it handles the provided position arguments

We've changed `report` so that it'll throw an error for the ambiguous position arguments that we deprecated in [16.13.0](https://stylelint.io/CHANGELOG#16130---2025-01-12).

You should update your plugin(s) to:

- always provide a PostCSS `node`
- provide both `start` and `end` as valid positions, if providing a [range](https://postcss.org/api/#range) within the given node
- provide both `index` and `endIndex` as numbers, if providing an index range within the given node

For example:

```diff js
root.walkRules((ruleNode) => {
  const { selector } = ruleNode;

  report({
    result,
    ruleName,
    message: messages.rejected(),
    node: ruleNode,
    index,
+   endIndex: index + selector.length
  });
});
```

### Changed `*-list` rules to have consistent behaviour for vendor prefixes and capitalisation

We've changed the following `*-list` rules so that their treatment of vendor prefixes and capitalisation is consistent with the other `*-list` rules and with the `ignore*: []` secondary options:

- `at-rule-allowed-list` (added regex support)
- `at-rule-disallowed-list` (added regex support)
- `declaration-property-unit-allowed-list`
- `declaration-property-unit-disallowed-list`
- `declaration-property-value-allowed-list`
- `declaration-property-value-disallowed-list`
- `function-allowed-list`
- `function-disallowed-list`
- `media-feature-name-value-allowed-list`
- `property-allowed-list`
- `property-disallowed-list`
- `selector-pseudo-class-allowed-list`
- `selector-pseudo-class-disallowed-list`
- `selector-pseudo-element-allowed-list`
- `selector-pseudo-element-disallowed-list`

These rules silently allowed or disallowed vendor-prefixed versions and different cases of the specified constructs. For example:

```json
{ "at-rule-allowed-list": ["supports"] }
```

Would problematically allow nonexistent and different case at-rules such as: `@-webkit-SUPPORTS`.

If you want to (dis)allow prefixes before constructs (in either case), you can use a regular expression (and include the `i` modifier). For example:

```diff json
-{ "at-rule-allowed-list": ["keyframes"] }
+{ "at-rule-allowed-list": ["/^(-webkit-|-moz-)?keyframes$/i"] }
```

## Significant changes

- undeprecated CommonJS plugins

### Undeprecated CommonJS plugins

When we [deprecated the CommonJS Node.js API in 16.0.0](./to-16.md#deprecated-commonjs-api) we also added a deprecation warning for CommonJS plugins because we assumed they would be incompatible with the ESM Node.js API. However, `require(ESM)` has since been added to Node.js 20.19+. So we've removed the deprecation warning.

You can follow the [advice above](#removed-commonjs-nodejs-api) to either migrate your plugin to ESM to modernise it or use `require("stylelint").default` in your CommonJS plugin to consume the ESM Node.js API.
