# Migrating to 17.0.0

This release contains breaking or significant changes.

We've migrated to ECMAScript modules (ESM), and modernised dozens of rules related to CSS nesting, specificity and vendor prefixes.

## Breaking changes

We've:

- removed CommonJs Node.js API
- removed `output` property in the Node.js API returned resolved object
- removed support for Node.js less than 20.19.0 and 22.13.0
- removed GitHub formatter
- changed default `fix` mode to `strict`
- changed report to be consistent and predictable in how it handles the provided position arguments
- changed `selector` and `specificity` rules for standard CSS nesting and modern functional pseudo-classes
- changed `*-list` rules to have consistent behaviour for vendor prefixes and case

### Removed CommonJs Node.js API

We've removed the CommonJs Node.js API that we deprecated in 16.0.0.

Node.js 20+ supports `require(ESM)` so you can continue to `require` Stylelint. However, we recommend updating any consuming code to ESM as detailed in our [16.0.0 migration guide](./to-16.md#deprecated-commonjs-api).

### Removed `output` property in the Node.js API returned resolved object

We've removed the `output` property that we [deprecated in 16.0.0](./to-16.md#changed-nodejs-api-returned-resolved-object).

If you use `stylelint.lint()` and `fix: true`, you should update your code to:

```diff js
 const result = await stylelint.lint({
   code: "a {}",
   fix: true
 });
-const fixedCode = result.output;
+const formattedProblems = result.report;
+const fixedCode = result.code;
```

### Removed support for Node.js less than 20.19.0 and 22.13.0

We've removed support for Node.js versions less than 20.19.0 and 22.13.0, including end-of-life 18.x, to update all our dependencies.

We update our dependencies on a [cool-down](https://github.blog/changelog/2025-07-01-dependabot-supports-configuration-of-a-minimum-package-age/) to improve supply chain security, alongside [immutable releases](https://github.blog/changelog/2025-08-26-releases-now-support-immutability-in-public-preview/) on GitHub and [trusted publishing](https://github.blog/changelog/2025-07-31-npm-trusted-publishing-with-oidc-is-generally-available/) to npm.

We recommend updating to the latest version of Node.js.

### Removed GitHub formatter

We've removed the GitHub formatter than [we deprecated in 16.8.0](../../CHANGELOG.md#1680---2024-07-29).

You can use a formatter maintained by the community instead, such as [@csstools/stylelint-formatter-github](https://www.npmjs.com/package/@csstools/stylelint-formatter-github):

```shell
npm install --save-dev @csstools/stylelint-formatter-github
```

Using the Node.js API:

```diff js
import stylelint from "stylelint";
+import formatter from "@csstools/stylelint-formatter-github";

const result = await stylelint.lint({
  files: "**/*.css",
- formatter: "github",
+ formatter,
});
```

Using the CLI:

```diff shell
-stylelint "**/*.css" --formatter github
+stylelint "**/*.css" --custom-formatter @csstools/stylelint-formatter-github
```

### Changed default `fix` mode to `strict`

We've changed the default mode of `fix` to `strict`: one of the two modes that [we added in 16.13.0](../../CHANGELOG.md#16130---2025-01-12).

In `strict` mode, Stylelint will only fix problems when there are no syntax errors in the source. This mode is safer than the `lax` mode, especially when fixing code that uses nesting.

If you want to reinstate the previous behaviour, you can set the `lax` value for the `--fix` flag:

```diff shell
-stylelint "**/*.css" --fix
+stylelint "**/*.css" --fix=lax
```

We've also removed the use of `fix=false` to turn off fixing. Remove the flag entirely instead:

```diff shell
-stylelint "**/*.css" --fix=false
+stylelint "**/*.css"
```

### Changed `report` to be consistent and predictable in how it handles the provided position arguments

We've changed `report` so that it'll throw an error for the ambiguous position arguments that we deprecated in [16.13.0](https://stylelint.io/CHANGELOG#16130---2025-01-12).

You should update your plugin(s) to:

- always provide a PostCSS `node`
- provide both `start` and `end` as valid positions, if providing a [range](https://postcss.org/api/#range) within the given node
- provide both `index` and `endIndex` as numbers, if providing an index range within the given node

For example:

```diff js
root.walkRules((ruleNode) => {
  const { selector } = ruleNode;

  report({
    result,
    ruleName,
    message: messages.rejected(),
    node: ruleNode,
    index,
+   endIndex: index + selector.length
  });
});
```

### Changed `selector` and `specificity` rules for standard CSS nesting and modern functional pseudo-classes

We've changed the `selector` and `specificity` rules to account for CSS nesting and modern functional pseudo-classes, such as `:is()`, `:where()` and `:has()`.

We've changed the following syntax rules:

- `selector-max-attribute`
- `selector-max-class`
- `selector-max-combinators`
- `selector-max-compound-selectors`
- `selector-max-id`
- `selector-max-pseudo-class`
- `selector-max-type`
- `selector-max-universal`

So that they no longer:

- desugar nesting
- evaluate functional pseudo-classes separately, such as `:is()` and `:not()`

We've changed the `selector-max-specificity` and `no-descending-specificity` semantic rules to adhere to [CSS Nesting specification](https://drafts.csswg.org/css-nesting/#nest-selector):

> The [specificity](https://drafts.csswg.org/selectors-4/#specificity) of the [nesting selector](https://drafts.csswg.org/css-nesting/#nesting-selector) is equal to the largest specificity among the complex selectors in the parent style ruleâ€™s selector list (identical to the behavior of [:is()](https://drafts.csswg.org/selectors-4/#matches-pseudo)), or zero if no such selector list exists.

We've changed `no-duplicate-selectors` and `selector-no-qualifying-type` to resolve selectors according to [standard nesting](https://drafts.csswg.org/css-nesting), rather than nonstandard nesting of language extensions such as SCSS, before checking them.

We've removed two secondary options that conflict with the changes above:

- `checkContextFunctionalPseudoClasses` for `selector-max-id` (new default behaviour)
- `resolveNestedSelectors` for `selector-class-pattern` (incompatible with standard nesting)

If you use a language extension that uses nonstandard nesting, such as SCSS or Less, you should turn off the `*-specificity`, `no-duplicate-selector` and `selector-no-qualifying-type` rules in your config.

Standard nesting often desugars to `:is()`. For example, the following:

<!-- prettier-ignore -->
```css
#foo,
.bar {
  & a {}
}
```

Is desugared to:

<!-- prettier-ignore -->
```css
:is(#foo, .bar) a {}
```

This behaviour, when hidden, can lead to surprising lint problems being flagged. As we no longer desugar nesting in the `selector-max-*` syntax rules, the selectors you see in your source files are now linted as-is, so there are no surprises.

As the syntax `selector-max-*` rules no longer evaluate functional pseudo-classes separately, you may need to increase your maxes. For example:

<!-- prettier-ignore -->
```css
.foo:has(.bar) {}
```

```diff json
-{ "selector-max-class": 1 }
+{ "selector-max-class": 2 }
```

For the semantic `*-specificity` rules, we've added the resolved selector(s) to the rule messages to help you understand the specificity calculation.

### Changed `*-list` rules to have consistent behaviour for vendor prefixes and case

We've changed the following `*-list` rules so that their treatment of vendor prefixes and case is consistent with the other `*-list` rules and with the `ignore*: []` secondary options:

- `at-rule-allowed-list` (added regex support)
- `at-rule-disallowed-list` (added regex support)
- `declaration-property-unit-allowed-list`
- `declaration-property-unit-disallowed-list`
- `declaration-property-value-allowed-list`
- `declaration-property-value-disallowed-list`
- `function-allowed-list`
- `function-disallowed-list`
- `media-feature-name-value-allowed-list`
- `property-allowed-list`
- `property-disallowed-list`
- `selector-pseudo-class-allowed-list`
- `selector-pseudo-class-disallowed-list`
- `selector-pseudo-element-allowed-list`
- `selector-pseudo-element-disallowed-list`

These rules silently allowed or disallowed vendor-prefixed versions and different cases of the specified constructs. For example:

```json
{ "at-rule-allowed-list": ["supports"] }
```

Would problematically allow nonexistent and different case at-rules such as: `@-webkit-SUPPORTS`.

If you want to (dis)allow prefixes before constructs (in either case), you can use a regular expression (and include the `i` modifier). For example:

```diff json
-{ "at-rule-allowed-list": ["keyframes"] }
+{ "at-rule-allowed-list": ["/^(-webkit-|-moz-)?keyframes$/i"] }
```

## Significant changes

- undeprecated CommonJS plugins

### Undeprecated CommonJS plugins

When we [deprecated the CommonJS Node.js API in 16.0.0](./to-16.md#deprecated-commonjs-api) we also added a deprecation warning for CommonJS plugins because we assumed they would be incompatible with the ESM Node.js API. However, `require(ESM)` has since been added to Node.js 20.19+. So we've removed the deprecation warning.

Jest, and therefore [`jest-preset-stylelint`](https://www.npmjs.com/package/jest-preset-stylelint), is currently incompatible with `require(ESM)`. You can use [`stylelint-test-rule-node`](https://www.npmjs.com/package/stylelint-test-rule-node) to test your CommonJS plugin, or migrate your plugin to ESM. We recommend doing both.
